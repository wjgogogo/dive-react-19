# 开发准则

## 概述

在深入 React 19 源码之前，我们需要了解一些核心开发准则，这些准则将指导我们如何正确地阅读、理解和调试 React 源码。

## Principal 原则

React 团队在开发过程中遵循一些核心原则，这些原则也是我们学习源码时需要理解的：

### 1. 性能优先

React 的设计始终以性能为首要考虑因素：

- **时间切片**：通过 Scheduler 实现任务的可中断执行
- **优先级调度**：不同类型的更新具有不同的优先级
- **批量更新**：将多个状态更新合并为一次渲染

### 2. 开发者体验

React 注重开发者的使用体验：

- **声明式编程**：描述界面应该是什么样子，而不是如何实现
- **组件化思维**：将复杂的 UI 拆分为独立的组件
- **工具生态**：提供丰富的开发工具和错误提示

### 3. 向后兼容

React 在新版本中尽可能保持向后兼容：

- **渐进式升级**：新特性可以逐步采用
- **废弃警告**：在移除功能前提供充分的警告时间
- **迁移指南**：提供详细的升级文档

## 忽略开发验证

在学习源码过程中，我们通常会忽略一些开发环境的验证代码：

### 开发环境检查

```javascript
// 这类代码在生产环境中会被移除
if (__DEV__) {
  // 开发环境警告和检查
  console.warn('这是开发环境警告');
}
```

### 类型检查

```javascript
// PropTypes 等类型检查在生产环境中被优化掉
if (__DEV__) {
  Component.propTypes = {
    name: PropTypes.string.isRequired
  };
}
```

### 为什么忽略这些代码？

1. **专注核心逻辑**：开发验证代码不影响核心渲染逻辑
2. **简化学习过程**：避免被大量的检查代码干扰
3. **理解生产行为**：了解代码在生产环境中的真实表现

## 源码阅读策略

### 1. 自顶向下

从 React 应用的入口开始：

```javascript
// 从 ReactDOM.render 或 createRoot 开始
const root = createRoot(container);
root.render(<App />);
```

### 2. 关注主线程

重点关注渲染的主要流程：

1. **Render 阶段**：构建 Fiber 树
2. **Commit 阶段**：应用变更到 DOM

### 3. 忽略优化细节

在初学阶段可以忽略的内容：

- 具体的性能优化实现
- 边界情况的处理
- 开发环境的特殊逻辑

## 调试准则

### 1. 设置断点的位置

推荐在以下位置设置断点：

```javascript
// 组件渲染入口
function App() {
  debugger; // 在这里设置断点
  return <div>Hello World</div>;
}

// Hook 调用处
function useCustomHook() {
  debugger; // 观察 Hook 的执行
  const [state, setState] = useState(0);
  return [state, setState];
}
```

### 2. 观察关键变量

在调试过程中重点观察：

- **workInProgress**：当前工作的 Fiber 节点
- **current**：当前显示的 Fiber 树
- **lanes**：当前更新的优先级
- **pendingTime**：挂起任务的时间

### 3. 使用 React DevTools

React DevTools 提供了丰富的调试功能：

- **组件树查看**：查看组件的层次结构
- **Props 和 State 查看**：观察组件的状态变化
- **性能分析**：使用 Profiler 分析性能瓶颈

## 学习路径建议

### 初学者路径

1. **基础概念**：了解 JSX、组件、Props、State
2. **渲染流程**：理解 Mount 和 Update 过程
3. **Hook 机制**：掌握 useState、useEffect 的实现
4. **调度系统**：学习 Scheduler 的工作原理

### 进阶路径

1. **Fiber 架构**：深入理解 Fiber 的数据结构
2. **并发模式**：学习 Time Slicing 和优先级调度
3. **性能优化**：掌握各种优化策略
4. **生态集成**：了解与其他库的集成方式

## 常见陷阱

### 1. 过度关注细节

刚开始学习时，不要过度关注：

- 具体的算法实现细节
- 边界情况的处理
- 性能优化的具体实现

### 2. 忽略整体架构

避免只关注局部代码而忽略：

- 模块之间的关系
- 数据流向
- 整体的设计思想

### 3. 不实践验证

理论学习需要结合实践：

- 编写测试用例验证理解
- 修改源码观察效果
- 使用调试工具分析行为

## 总结

遵循这些开发准则将帮助我们更高效地学习 React 源码：

1. **理解设计原则**：性能、体验、兼容性
2. **正确的学习策略**：自顶向下、关注主线程
3. **有效的调试方法**：合理设置断点、观察关键变量
4. **避免常见陷阱**：不过度关注细节、保持整体视角

这些准则将在整个学习过程中指导我们更好地理解 React 的设计思想和实现细节。