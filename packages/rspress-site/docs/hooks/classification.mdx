# Hook åˆ†ç±»

## æ¦‚è¿°

React 19 æä¾›äº†ä¸°å¯Œçš„å†…ç½® Hookï¼Œæ¯ä¸ª Hook éƒ½æœ‰ç‰¹å®šçš„ç”¨é€”å’Œå®ç°æœºåˆ¶ã€‚æœ¬ç« å°†é€šè¿‡å¯æ‰§è¡Œçš„æ¡ˆä¾‹æ·±å…¥åˆ†æä¸åŒ Hook çš„åˆ†ç±»ã€å·¥ä½œåŸç†ï¼Œä»¥åŠå®ƒä»¬åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯ã€‚æˆ‘ä»¬è¿˜ä¼šä¸ Vue 3 çš„ Composition API è¿›è¡Œå¯¹æ¯”ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ React Hook çš„è®¾è®¡æ€æƒ³ã€‚

## å¯æ‰§è¡Œæ¡ˆä¾‹ï¼šHook åˆ†ç±»æ¼”ç¤º

### ç»¼åˆæ¡ˆä¾‹ï¼šä»»åŠ¡ç®¡ç†åº”ç”¨

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡ç®¡ç†åº”ç”¨æ¥ç†è§£å„ç§ Hook çš„ä½¿ç”¨ï¼š

```javascript
// åœ¨ packages/react-dojo/dojo/index.jsx ä¸­å°è¯•è¿™ä¸ªå®Œæ•´æ¡ˆä¾‹

import React, { useState, useEffect, useMemo, useCallback, useRef, useContext, useReducer, useTransition, useDeferredValue, useId } from 'react';

// åˆ›å»ºä¸»é¢˜ä¸Šä¸‹æ–‡
const ThemeContext = React.createContext();

// ä»»åŠ¡çŠ¶æ€ç®¡ç† reducer
function taskReducer(state, action) {
  switch (action.type) {
    case 'ADD_TASK':
      return {
        ...state,
        tasks: [...state.tasks, { 
          id: Date.now(), 
          title: action.payload, 
          completed: false,
          createdAt: new Date()
        }],
        stats: {
          ...state.stats,
          total: state.stats.total + 1
        }
      };
    case 'TOGGLE_TASK':
      const newTasks = state.tasks.map(task =>
        task.id === action.payload
          ? { ...task, completed: !task.completed }
          : task
      );
      const completedCount = newTasks.filter(t => t.completed).length;
      return {
        ...state,
        tasks: newTasks,
        stats: {
          total: state.stats.total,
          completed: completedCount,
          pending: state.stats.total - completedCount
        }
      };
    case 'DELETE_TASK':
      const filteredTasks = state.tasks.filter(task => task.id !== action.payload);
      const newCompletedCount = filteredTasks.filter(t => t.completed).length;
      return {
        ...state,
        tasks: filteredTasks,
        stats: {
          total: filteredTasks.length,
          completed: newCompletedCount,
          pending: filteredTasks.length - newCompletedCount
        }
      };
    default:
      return state;
  }
}

// ä¸»é¢˜æä¾›è€…ç»„ä»¶
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');
  
  const toggleTheme = useCallback(() => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  }, []);
  
  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// ä»»åŠ¡ç®¡ç†ä¸»ç»„ä»¶
function TaskManager() {
  // ğŸ”µ çŠ¶æ€ç®¡ç† Hook
  const [searchQuery, setSearchQuery] = useState('');
  const [sortBy, setSortBy] = useState('createdAt');
  
  // ğŸ”µ å¤æ‚çŠ¶æ€ç®¡ç† Hook
  const [state, dispatch] = useReducer(taskReducer, {
    tasks: [],
    stats: { total: 0, completed: 0, pending: 0 }
  });
  
  // ğŸ”µ ä¸Šä¸‹æ–‡ Hook
  const { theme, toggleTheme } = useContext(ThemeContext);
  
  // ğŸ”µ æ€§èƒ½ä¼˜åŒ– Hook
  const deferredSearchQuery = useDeferredValue(searchQuery);
  
  // ğŸ”µ å¹¶å‘ç‰¹æ€§ Hook
  const [isPending, startTransition] = useTransition();
  
  // ğŸ”µ å·¥å…·ç±» Hook
  const taskInputRef = useRef(null);
  const formId = useId();
  
  // ğŸ”µ å‰¯ä½œç”¨ Hook
  useEffect(() => {
    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem('tasks', JSON.stringify(state.tasks));
  }, [state.tasks]);
  
  useEffect(() => {
    // ä»æœ¬åœ°å­˜å‚¨æ¢å¤
    const saved = localStorage.getItem('tasks');
    if (saved) {
      const tasks = JSON.parse(saved);
      tasks.forEach(task => {
        dispatch({ type: 'ADD_TASK', payload: task.title });
      });
    }
  }, []);
  
  // ğŸ”µ æ€§èƒ½ä¼˜åŒ–çš„è®¡ç®—
  const filteredAndSortedTasks = useMemo(() => {
    console.log('ğŸ”„ é‡æ–°è®¡ç®—è¿‡æ»¤å’Œæ’åºçš„ä»»åŠ¡åˆ—è¡¨');
    
    let filtered = state.tasks;
    
    // æœç´¢è¿‡æ»¤
    if (deferredSearchQuery) {
      filtered = filtered.filter(task =>
        task.title.toLowerCase().includes(deferredSearchQuery.toLowerCase())
      );
    }
    
    // æ’åº
    return filtered.sort((a, b) => {
      if (sortBy === 'createdAt') {
        return new Date(b.createdAt) - new Date(a.createdAt);
      } else if (sortBy === 'title') {
        return a.title.localeCompare(b.title);
      } else if (sortBy === 'status') {
        return a.completed - b.completed;
      }
      return 0;
    });
  }, [state.tasks, deferredSearchQuery, sortBy]);
  
  // ğŸ”µ äº‹ä»¶å¤„ç†å‡½æ•°ç¼“å­˜
  const handleAddTask = useCallback((e) => {
    e.preventDefault();
    const title = taskInputRef.current?.value.trim();
    if (title) {
      dispatch({ type: 'ADD_TASK', payload: title });
      taskInputRef.current.value = '';
      taskInputRef.current.focus();
    }
  }, []);
  
  const handleSearchChange = useCallback((e) => {
    const query = e.target.value;
    setSearchQuery(query);
    
    // ä½¿ç”¨ startTransition æ ‡è®°æœç´¢ä¸ºä½ä¼˜å…ˆçº§æ›´æ–°
    startTransition(() => {
      // è¿™é‡Œå¯ä»¥æ”¾ä¸€äº›ä¸ç´§æ€¥çš„æ›´æ–°
      console.log('æœç´¢æŸ¥è¯¢æ›´æ–°:', query);
    });
  }, [startTransition]);
  
  const handleToggleTask = useCallback((id) => {
    dispatch({ type: 'TOGGLE_TASK', payload: id });
  }, []);
  
  const handleDeleteTask = useCallback((id) => {
    dispatch({ type: 'DELETE_TASK', payload: id });
  }, []);
  
  return (
    <div 
      className={`task-manager ${theme}`}
      style={{
        padding: '20px',
        backgroundColor: theme === 'dark' ? '#2d3748' : '#ffffff',
        color: theme === 'dark' ? '#ffffff' : '#000000',
        minHeight: '100vh'
      }}
    >
      <header style={{ marginBottom: '20px' }}>
        <h1>ä»»åŠ¡ç®¡ç†å™¨ {isPending && 'â³'}</h1>
        <button onClick={toggleTheme}>
          åˆ‡æ¢åˆ° {theme === 'light' ? 'æ·±è‰²' : 'æµ…è‰²'} ä¸»é¢˜
        </button>
      </header>
      
      {/* ç»Ÿè®¡ä¿¡æ¯ */}
      <div style={{ marginBottom: '20px', padding: '10px', border: '1px solid #ccc' }}>
        <h3>ç»Ÿè®¡ä¿¡æ¯</h3>
        <p>æ€»ä»»åŠ¡: {state.stats.total}</p>
        <p>å·²å®Œæˆ: {state.stats.completed}</p>
        <p>å¾…å®Œæˆ: {state.stats.pending}</p>
      </div>
      
      {/* æ·»åŠ ä»»åŠ¡è¡¨å• */}
      <form onSubmit={handleAddTask} style={{ marginBottom: '20px' }}>
        <label htmlFor={`${formId}-task-input`}>æ·»åŠ æ–°ä»»åŠ¡:</label>
        <input
          id={`${formId}-task-input`}
          ref={taskInputRef}
          type="text"
          placeholder="è¾“å…¥ä»»åŠ¡æ ‡é¢˜..."
          style={{ marginLeft: '10px', marginRight: '10px', padding: '5px' }}
        />
        <button type="submit">æ·»åŠ </button>
      </form>
      
      {/* æœç´¢å’Œæ’åº */}
      <div style={{ marginBottom: '20px' }}>
        <input
          type="text"
          value={searchQuery}
          onChange={handleSearchChange}
          placeholder="æœç´¢ä»»åŠ¡..."
          style={{ marginRight: '10px', padding: '5px' }}
        />
        <select 
          value={sortBy} 
          onChange={(e) => setSortBy(e.target.value)}
          style={{ padding: '5px' }}
        >
          <option value="createdAt">æŒ‰åˆ›å»ºæ—¶é—´æ’åº</option>
          <option value="title">æŒ‰æ ‡é¢˜æ’åº</option>
          <option value="status">æŒ‰çŠ¶æ€æ’åº</option>
        </select>
      </div>
      
      {/* ä»»åŠ¡åˆ—è¡¨ */}
      <div>
        <h3>ä»»åŠ¡åˆ—è¡¨ ({filteredAndSortedTasks.length})</h3>
        {filteredAndSortedTasks.map(task => (
          <div 
            key={task.id} 
            style={{ 
              padding: '10px', 
              margin: '5px 0', 
              border: '1px solid #ccc',
              backgroundColor: task.completed ? '#d4edda' : 'transparent'
            }}
          >
            <input
              type="checkbox"
              checked={task.completed}
              onChange={() => handleToggleTask(task.id)}
              style={{ marginRight: '10px' }}
            />
            <span 
              style={{ 
                textDecoration: task.completed ? 'line-through' : 'none',
                marginRight: '10px'
              }}
            >
              {task.title}
            </span>
            <small style={{ color: '#666', marginRight: '10px' }}>
              {new Date(task.createdAt).toLocaleString()}
            </small>
            <button 
              onClick={() => handleDeleteTask(task.id)}
              style={{ 
                backgroundColor: '#dc3545', 
                color: 'white', 
                border: 'none', 
                padding: '2px 8px' 
              }}
            >
              åˆ é™¤
            </button>
          </div>
        ))}
        
        {filteredAndSortedTasks.length === 0 && (
          <p style={{ color: '#666', fontStyle: 'italic' }}>
            {deferredSearchQuery ? 'æ²¡æœ‰åŒ¹é…çš„ä»»åŠ¡' : 'æš‚æ— ä»»åŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼'}
          </p>
        )}
      </div>
      
      {/* Hook ä½¿ç”¨ç»Ÿè®¡ */}
      <details style={{ marginTop: '20px' }}>
        <summary>æœ¬ç»„ä»¶ä½¿ç”¨çš„ Hook ç»Ÿè®¡</summary>
        <ul>
          <li>âœ… useState: 2 ä¸ª (searchQuery, sortBy)</li>
          <li>âœ… useReducer: 1 ä¸ª (å¤æ‚çŠ¶æ€ç®¡ç†)</li>
          <li>âœ… useContext: 1 ä¸ª (ä¸»é¢˜ä¸Šä¸‹æ–‡)</li>
          <li>âœ… useEffect: 2 ä¸ª (æœ¬åœ°å­˜å‚¨)</li>
          <li>âœ… useMemo: 1 ä¸ª (ä»»åŠ¡è¿‡æ»¤æ’åº)</li>
          <li>âœ… useCallback: 4 ä¸ª (äº‹ä»¶å¤„ç†å‡½æ•°)</li>
          <li>âœ… useRef: 1 ä¸ª (è¾“å…¥æ¡†å¼•ç”¨)</li>
          <li>âœ… useTransition: 1 ä¸ª (ä½ä¼˜å…ˆçº§æ›´æ–°)</li>
          <li>âœ… useDeferredValue: 1 ä¸ª (å»¶è¿Ÿæœç´¢)</li>
          <li>âœ… useId: 1 ä¸ª (å”¯ä¸€ ID ç”Ÿæˆ)</li>
        </ul>
      </details>
    </div>
  );
}

// åº”ç”¨æ ¹ç»„ä»¶
function App() {
  return (
    <ThemeProvider>
      <TaskManager />
    </ThemeProvider>
  );
}

export default App;
```

### æ¡ˆä¾‹åˆ†æï¼šæ¯ä¸ª Hook çš„ä½œç”¨

è¿™ä¸ªä»»åŠ¡ç®¡ç†åº”ç”¨å±•ç¤ºäº†å„ç§ Hook çš„å®é™…åº”ç”¨åœºæ™¯ï¼š

1. **useState**: ç®¡ç†ç®€å•çš„æœ¬åœ°çŠ¶æ€ï¼ˆæœç´¢æŸ¥è¯¢ã€æ’åºæ–¹å¼ï¼‰
2. **useReducer**: ç®¡ç†å¤æ‚çš„çŠ¶æ€é€»è¾‘ï¼ˆä»»åŠ¡åˆ—è¡¨å’Œç»Ÿè®¡ï¼‰
3. **useContext**: è·¨ç»„ä»¶å…±äº«çŠ¶æ€ï¼ˆä¸»é¢˜ç³»ç»Ÿï¼‰
4. **useEffect**: å¤„ç†å‰¯ä½œç”¨ï¼ˆæœ¬åœ°å­˜å‚¨åŒæ­¥ï¼‰
5. **useMemo**: ç¼“å­˜æ˜‚è´µè®¡ç®—ï¼ˆä»»åŠ¡è¿‡æ»¤å’Œæ’åºï¼‰
6. **useCallback**: ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼ˆé˜²æ­¢å­ç»„ä»¶ä¸å¿…è¦é‡æ¸²æŸ“ï¼‰
7. **useRef**: è®¿é—® DOM å…ƒç´ ï¼ˆè¾“å…¥æ¡†æ“ä½œï¼‰
8. **useTransition**: æ ‡è®°éç´§æ€¥æ›´æ–°ï¼ˆæœç´¢åŠŸèƒ½ï¼‰
9. **useDeferredValue**: å»¶è¿Ÿå€¼æ›´æ–°ï¼ˆé˜²æ­¢è¾“å…¥å¡é¡¿ï¼‰
10. **useId**: ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè¡¨å•æ ‡ç­¾å…³è”ï¼‰

## Hook åˆ†ç±»ä½“ç³»

### æŒ‰åŠŸèƒ½åˆ†ç±»

```mermaid
graph TD
    A[React Hooks] --> B[çŠ¶æ€ Hook]
    A --> C[å‰¯ä½œç”¨ Hook]
    A --> D[æ€§èƒ½ä¼˜åŒ– Hook]
    A --> E[ä¸Šä¸‹æ–‡ Hook]
    A --> F[å¹¶å‘ç‰¹æ€§ Hook]
    A --> G[å·¥å…·ç±» Hook]
    
    B --> B1[useState]
    B --> B2[useReducer]
    
    C --> C1[useEffect]
    C --> C2[useLayoutEffect]
    C --> C3[useInsertionEffect]
    
    D --> D1[useMemo]
    D --> D2[useCallback]
    
    E --> E1[useContext]
    
    F --> F1[useTransition]
    F --> F2[useDeferredValue]
    F --> F3[useSyncExternalStore]
    
    G --> G1[useRef]
    G --> G2[useImperativeHandle]
    G --> G3[useId]
    G --> G4[useDebugValue]
```

### æŒ‰å®ç°æœºåˆ¶åˆ†ç±»

```mermaid
graph TD
    A[Hook å®ç°æœºåˆ¶] --> B[æœ‰çŠ¶æ€ Hook]
    A --> C[æ— çŠ¶æ€ Hook]
    
    B --> B1[éœ€è¦ dispatcher]
    B --> B2[ç»´æŠ¤å†…éƒ¨çŠ¶æ€]
    B --> B3[è§¦å‘é‡æ¸²æŸ“]
    
    C --> C1[ä¸ç»´æŠ¤çŠ¶æ€]
    C --> C2[åªæä¾›å·¥å…·åŠŸèƒ½]
    C --> C3[ä¸è§¦å‘é‡æ¸²æŸ“]
    
    B1 --> D1[useState]
    B1 --> D2[useReducer]
    B1 --> D3[useEffect]
    
    C1 --> E1[useRef]
    C1 --> E2[useCallback]
    C1 --> E3[useMemo]
```

## React Hook vs Vue 3 Composition API æ·±åº¦å¯¹æ¯”

### çŠ¶æ€ç®¡ç†å¯¹æ¯”æ¡ˆä¾‹

#### React Hook å®ç°

```javascript
// React Hook çŠ¶æ€ç®¡ç†
function useShoppingCart() {
  const [items, setItems] = useState([]);
  const [loading, setLoading] = useState(false);
  
  // React éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–è®¡ç®—
  const totalPrice = useMemo(() => {
    return items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }, [items]);
  
  const addItem = useCallback((product) => {
    setItems(prevItems => {
      const existingItem = prevItems.find(item => item.id === product.id);
      if (existingItem) {
        return prevItems.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      return [...prevItems, { ...product, quantity: 1 }];
    });
  }, []);
  
  const removeItem = useCallback((productId) => {
    setItems(prevItems => prevItems.filter(item => item.id !== productId));
  }, []);
  
  // React å‰¯ä½œç”¨éœ€è¦æ‰‹åŠ¨ç®¡ç†ä¾èµ–
  useEffect(() => {
    if (items.length > 0) {
      setLoading(true);
      // æ¨¡æ‹Ÿä¿å­˜åˆ°æœåŠ¡å™¨
      setTimeout(() => {
        localStorage.setItem('cart', JSON.stringify(items));
        setLoading(false);
      }, 500);
    }
  }, [items]);
  
  return { items, loading, totalPrice, addItem, removeItem };
}
```

#### Vue 3 Composition API å®ç°

```javascript
// Vue 3 Composition API çŠ¶æ€ç®¡ç† (ä»…ç”¨äºå¯¹æ¯”)
import { ref, computed, watch } from 'vue'

function useShoppingCart() {
  const items = ref([])
  const loading = ref(false)
  
  // Vue 3 è‡ªåŠ¨è¿½è¸ªä¾èµ–ï¼Œæ— éœ€æ‰‹åŠ¨ä¼˜åŒ–
  const totalPrice = computed(() => {
    return items.value.reduce((sum, item) => sum + item.price * item.quantity, 0)
  })
  
  const addItem = (product) => {
    const existingItem = items.value.find(item => item.id === product.id)
    if (existingItem) {
      existingItem.quantity++
    } else {
      items.value.push({ ...product, quantity: 1 })
    }
  }
  
  const removeItem = (productId) => {
    const index = items.value.findIndex(item => item.id === productId)
    if (index > -1) {
      items.value.splice(index, 1)
    }
  }
  
  // Vue 3 è‡ªåŠ¨è¿½è¸ªä¾èµ–å˜åŒ–
  watch(items, (newItems) => {
    if (newItems.length > 0) {
      loading.value = true
      setTimeout(() => {
        localStorage.setItem('cart', JSON.stringify(newItems))
        loading.value = false
      }, 500)
    }
  }, { deep: true })
  
  return { items, loading, totalPrice, addItem, removeItem }
}
```

### è®¾è®¡å“²å­¦å¯¹æ¯”åˆ†æ

| æ–¹é¢ | React Hook | Vue 3 Composition API | åˆ†æ |
|------|------------|----------------------|------|
| **å¿ƒæ™ºæ¨¡å‹** | å‡½æ•°å¼ï¼Œä¸å¯å˜æ•°æ® | å“åº”å¼ï¼Œå¯å˜æ•°æ® | React æ›´æ¥è¿‘å‡½æ•°å¼ç¼–ç¨‹ï¼ŒVue æ›´æ¥è¿‘é¢å‘å¯¹è±¡ |
| **æ€§èƒ½ä¼˜åŒ–** | æ‰‹åŠ¨ï¼ˆuseMemo, useCallbackï¼‰ | è‡ªåŠ¨ï¼ˆå“åº”å¼ç³»ç»Ÿï¼‰ | Vue å¼€å‘æ›´ç®€å•ï¼ŒReact æ›´å¯æ§ |
| **å­¦ä¹ æ›²çº¿** | éœ€è¦ç†è§£é—­åŒ…ã€é‡æ–°æ¸²æŸ“ | å“åº”å¼æ¦‚å¿µæ›´ç›´è§‚ | Vue å¯¹åˆå­¦è€…æ›´å‹å¥½ |
| **è°ƒè¯•ä½“éªŒ** | éœ€è¦ç†è§£æ¸²æŸ“æ—¶æœº | çŠ¶æ€å˜åŒ–ç«‹å³å¯è§ | Vue è°ƒè¯•æ›´ç›´è§‚ |
| **TypeScript** | ä¼˜ç§€çš„ç±»å‹æ¨å¯¼ | ä¼˜ç§€çš„ç±»å‹æ¨å¯¼ | ä¸¤è€…éƒ½å¾ˆå¥½ |
| **ç”Ÿæ€ç³»ç»Ÿ** | æœ€æˆç†Ÿ | å¿«é€Ÿå‘å±• | React ç›®å‰ä»æœ‰ä¼˜åŠ¿ |

### ä¸ºä»€ä¹ˆ React é€‰æ‹©è¿™ç§è®¾è®¡ï¼Ÿ

#### 1. ä¸å¯å˜æ€§çš„ä¼˜åŠ¿

```javascript
// React çš„ä¸å¯å˜æ€§è®¾è®¡ä¼˜åŠ¿æ¼”ç¤º
function TodoList() {
  const [todos, setTodos] = useState([]);
  
  // âœ… ä¸å¯å˜æ›´æ–°ï¼Œä¾¿äºæ—¶é—´æ—…è¡Œè°ƒè¯•
  const addTodo = (text) => {
    setTodos(prevTodos => [
      ...prevTodos,
      { id: Date.now(), text, completed: false }
    ]);
  };
  
  // âœ… å¯ä»¥è½»æ¾å®ç°æ’¤é”€åŠŸèƒ½
  const [history, setHistory] = useState([]);
  
  const updateTodos = (newTodos) => {
    setHistory(prev => [...prev, todos]); // ä¿å­˜å†å²çŠ¶æ€
    setTodos(newTodos);
  };
  
  const undo = () => {
    if (history.length > 0) {
      const previousState = history[history.length - 1];
      setTodos(previousState);
      setHistory(prev => prev.slice(0, -1));
    }
  };
  
  return (
    <div>
      {todos.map(todo => <TodoItem key={todo.id} todo={todo} />)}
      <button onClick={undo} disabled={history.length === 0}>
        æ’¤é”€ ({history.length})
      </button>
    </div>
  );
}
```

#### 2. å¯é¢„æµ‹çš„é‡æ–°æ¸²æŸ“

```javascript
// React æ¸²æŸ“çš„å¯é¢„æµ‹æ€§
function Parent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');
  
  console.log('Parent é‡æ–°æ¸²æŸ“'); // æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šæ‰§è¡Œ
  
  // å­ç»„ä»¶åªåœ¨ count å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“
  return (
    <div>
      <ExpensiveChild count={count} />
      <input value={name} onChange={e => setName(e.target.value)} />
      <button onClick={() => setCount(count + 1)}>å¢åŠ è®¡æ•°</button>
    </div>
  );
}

const ExpensiveChild = memo(({ count }) => {
  console.log('ExpensiveChild é‡æ–°æ¸²æŸ“');
  
  // æ˜‚è´µçš„è®¡ç®—
  const result = useMemo(() => {
    return Array.from({ length: count }, (_, i) => i).reduce((sum, n) => sum + n, 0);
  }, [count]);
  
  return <div>ç»“æœ: {result}</div>;
});
```

## çŠ¶æ€ç®¡ç† Hook æ·±åº¦è§£æ

### 1. useState æºç å·¥ä½œåŸç†

**ç”¨é€”**ï¼šç®¡ç†ç»„ä»¶çš„å±€éƒ¨çŠ¶æ€

```javascript
// useState çš„ä½¿ç”¨æ¡ˆä¾‹
function InteractiveCounter() {
  const [count, setCount] = useState(0);
  const [step, setStep] = useState(1);
  const [history, setHistory] = useState([]);
  
  // æ¼”ç¤ºå‡½æ•°å¼æ›´æ–°çš„ä¼˜åŠ¿
  const increment = () => {
    setCount(prevCount => {
      const newCount = prevCount + step;
      // åŒæ—¶æ›´æ–°å†å²è®°å½•
      setHistory(prevHistory => [
        ...prevHistory,
        { action: 'increment', from: prevCount, to: newCount, time: Date.now() }
      ]);
      return newCount;
    });
  };
  
  // æ¼”ç¤ºæ‰¹é‡æ›´æ–°
  const resetAll = () => {
    setCount(0);     // è¿™ä¸‰ä¸ªæ›´æ–°ä¼šè¢«æ‰¹å¤„ç†
    setStep(1);      // åªè§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“
    setHistory([]);  // (åœ¨ React 18+ ä¸­)
  };
  
  return (
    <div style={{ padding: '20px', border: '1px solid #ccc' }}>
      <h3>äº¤äº’å¼è®¡æ•°å™¨</h3>
      <p>å½“å‰å€¼: {count}</p>
      <p>æ­¥é•¿: {step}</p>
      
      <div style={{ marginBottom: '10px' }}>
        <button onClick={increment}>å¢åŠ  {step}</button>
        <button onClick={() => setCount(count - step)}>å‡å°‘ {step}</button>
        <button onClick={resetAll}>é‡ç½®æ‰€æœ‰</button>
      </div>
      
      <div style={{ marginBottom: '10px' }}>
        <label>
          æ­¥é•¿: 
          <input 
            type="number" 
            value={step} 
            onChange={e => setStep(Number(e.target.value))}
            style={{ marginLeft: '5px', width: '60px' }}
          />
        </label>
      </div>
      
      <details>
        <summary>æ“ä½œå†å² ({history.length})</summary>
        <div style={{ maxHeight: '100px', overflow: 'auto' }}>
          {history.slice(-10).map((entry, index) => (
            <div key={index} style={{ fontSize: '12px', margin: '2px 0' }}>
              {entry.action}: {entry.from} â†’ {entry.to} 
              (æ—¶é—´: {new Date(entry.time).toLocaleTimeString()})
            </div>
          ))}
        </div>
      </details>
    </div>
  );
}
```

**æºç ä½ç½®**ï¼š`react-reconciler/src/ReactFiberHooks.js`

```javascript
function useState(initialState) {
  return useReducer(basicStateReducer, initialState);
}

function basicStateReducer(state, action) {
  return typeof action === 'function' ? action(state) : action;
}
```

**ç‰¹ç‚¹**ï¼š
- æœ€ç®€å•çš„çŠ¶æ€ç®¡ç† Hook
- å†…éƒ¨å®é™…è°ƒç”¨ useReducer
- æ”¯æŒå‡½æ•°å¼æ›´æ–°
- å¯ä»¥ä¼ é€’åˆå§‹å€¼æˆ–åˆå§‹åŒ–å‡½æ•°

### 2. useReducer

**ç”¨é€”**ï¼šç®¡ç†å¤æ‚çš„çŠ¶æ€é€»è¾‘

```javascript
// å¤æ‚çŠ¶æ€ç®¡ç†
const initialState = { count: 0, history: [] };

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {
        count: state.count + 1,
        history: [...state.history, 'increment']
      };
    case 'decrement':
      return {
        count: state.count - 1,
        history: [...state.history, 'decrement']
      };
    case 'reset':
      return initialState;
    default:
      throw new Error();
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, initialState);
  
  return (
    <div>
      Count: {state.count}
      <button onClick={() => dispatch({ type: 'increment' })}>+</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>
      <button onClick={() => dispatch({ type: 'reset' })}>Reset</button>
    </div>
  );
}
```

**æºç å®ç°**ï¼š

```javascript
function useReducer(reducer, initialArg, init) {
  const hook = updateWorkInProgressHook();
  const queue = hook.queue;
  
  if (queue !== null) {
    // æœ‰æ›´æ–°é˜Ÿåˆ—ï¼Œå¤„ç†æ‰€æœ‰æ›´æ–°
    const dispatch = queue.dispatch;
    const pendingQueue = queue.pending;
    
    if (pendingQueue !== null) {
      // æ‰§è¡Œ reducer è®¡ç®—æ–°çŠ¶æ€
      const newState = updateReducer(hook, queue, reducer);
      return [newState, dispatch];
    }
  }
  
  // é¦–æ¬¡æ¸²æŸ“
  const initialState = init !== undefined ? init(initialArg) : initialArg;
  hook.memoizedState = hook.baseState = initialState;
  
  // åˆ›å»ºæ›´æ–°é˜Ÿåˆ—
  const queue = {
    pending: null,
    dispatch: null,
    lastRenderedReducer: reducer,
    lastRenderedState: initialState,
  };
  hook.queue = queue;
  
  // åˆ›å»º dispatch å‡½æ•°
  const dispatch = dispatchReducerAction.bind(null, currentlyRenderingFiber, queue);
  queue.dispatch = dispatch;
  
  return [hook.memoizedState, dispatch];
}
```

**ç‰¹ç‚¹**ï¼š
- é€‚åˆå¤æ‚çŠ¶æ€é€»è¾‘
- é¢„æµ‹æ€§çš„çŠ¶æ€æ›´æ–°
- ä¾¿äºæµ‹è¯•
- æ˜¯ useState çš„åº•å±‚å®ç°

## å‰¯ä½œç”¨ Hook

### 1. useEffect

**ç”¨é€”**ï¼šå¤„ç†å‰¯ä½œç”¨ï¼ˆæ•°æ®è·å–ã€è®¢é˜…ã€æ‰‹åŠ¨ DOM æ“ä½œç­‰ï¼‰

```javascript
function DataComponent({ userId }) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  // æ•°æ®è·å–å‰¯ä½œç”¨
  useEffect(() => {
    let cancelled = false;
    
    async function fetchData() {
      setLoading(true);
      try {
        const result = await api.fetchUser(userId);
        if (!cancelled) {
          setData(result);
        }
      } catch (error) {
        if (!cancelled) {
          console.error('è·å–æ•°æ®å¤±è´¥:', error);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    }
    
    fetchData();
    
    // æ¸…ç†å‡½æ•°
    return () => {
      cancelled = true;
    };
  }, [userId]); // ä¾èµ–æ•°ç»„
  
  // è®¢é˜…å‰¯ä½œç”¨
  useEffect(() => {
    const subscription = eventBus.subscribe('dataUpdate', handleDataUpdate);
    
    return () => {
      subscription.unsubscribe();
    };
  }, []); // ç©ºä¾èµ–æ•°ç»„ï¼Œåªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œ
  
  if (loading) return <div>Loading...</div>;
  return <div>{data?.name}</div>;
}
```

**æ‰§è¡Œæ—¶æœº**ï¼š
- åœ¨ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹åå¼‚æ­¥æ‰§è¡Œ
- ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•
- é€‚åˆå¤§å¤šæ•°å‰¯ä½œç”¨åœºæ™¯

### 2. useLayoutEffect

**ç”¨é€”**ï¼šåŒæ­¥æ‰§è¡Œçš„å‰¯ä½œç”¨ï¼Œåœ¨æ‰€æœ‰ DOM å˜æ›´ä¹‹åç«‹å³æ‰§è¡Œ

```javascript
function ResizeComponent() {
  const [height, setHeight] = useState(0);
  const divRef = useRef();
  
  useLayoutEffect(() => {
    // åŒæ­¥æµ‹é‡ DOM å°ºå¯¸
    const updateHeight = () => {
      if (divRef.current) {
        setHeight(divRef.current.offsetHeight);
      }
    };
    
    updateHeight();
    window.addEventListener('resize', updateHeight);
    
    return () => {
      window.removeEventListener('resize', updateHeight);
    };
  }, []);
  
  return (
    <div ref={divRef}>
      <p>Height: {height}px</p>
      <p>è¿™ä¸ªç»„ä»¶ä¼šåŒæ­¥æµ‹é‡è‡ªå·±çš„é«˜åº¦</p>
    </div>
  );
}
```

**æ‰§è¡Œæ—¶æœº**ï¼š
- åœ¨æ‰€æœ‰ DOM å˜æ›´ä¹‹ååŒæ­¥æ‰§è¡Œ
- ä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶
- é€‚åˆéœ€è¦åŒæ­¥è¯»å– DOM å¸ƒå±€çš„åœºæ™¯

### 3. useInsertionEffect

**ç”¨é€”**ï¼šåœ¨æ‰€æœ‰ DOM å˜æ›´ä¹‹å‰æ‰§è¡Œï¼Œä¸»è¦ç”¨äº CSS-in-JS åº“

```javascript
function useCSS(css) {
  useInsertionEffect(() => {
    // åœ¨ DOM å˜æ›´å‰æ’å…¥æ ·å¼
    const style = document.createElement('style');
    style.textContent = css;
    document.head.appendChild(style);
    
    return () => {
      document.head.removeChild(style);
    };
  }, [css]);
}

function StyledComponent() {
  useCSS(`
    .my-component {
      background: linear-gradient(45deg, #f0f, #0ff);
      padding: 20px;
    }
  `);
  
  return <div className="my-component">Styled content</div>;
}
```

**æ‰§è¡Œæ—¶æœº**ï¼š
- åœ¨æ‰€æœ‰ DOM å˜æ›´ä¹‹å‰åŒæ­¥æ‰§è¡Œ
- æ¯” useLayoutEffect æ›´æ—©æ‰§è¡Œ
- ä¸»è¦ç”¨äº CSS-in-JS åº“é¿å…æ ·å¼é—ªçƒ

## æ€§èƒ½ä¼˜åŒ– Hook

### 1. useMemo

**ç”¨é€”**ï¼šç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—

```javascript
function ExpensiveComponent({ items, filter }) {
  // ç¼“å­˜è®¡ç®—ç»“æœ
  const filteredItems = useMemo(() => {
    console.log('æ‰§è¡Œè¿‡æ»¤è®¡ç®—');
    return items.filter(item => item.category === filter);
  }, [items, filter]);
  
  // ç¼“å­˜å¤æ‚å¯¹è±¡
  const expensiveValue = useMemo(() => ({
    total: items.length,
    filtered: filteredItems.length,
    ratio: filteredItems.length / items.length,
  }), [items.length, filteredItems.length]);
  
  return (
    <div>
      <p>æ€»æ•°: {expensiveValue.total}</p>
      <p>è¿‡æ»¤å: {expensiveValue.filtered}</p>
      <p>æ¯”ä¾‹: {expensiveValue.ratio.toFixed(2)}</p>
    </div>
  );
}
```

**æºç å®ç°**ï¼š

```javascript
function useMemo(create, deps) {
  const hook = updateWorkInProgressHook();
  const nextDeps = deps === undefined ? null : deps;
  const prevState = hook.memoizedState;
  
  if (prevState !== null) {
    if (nextDeps !== null) {
      const prevDeps = prevState[1];
      if (areHookInputsEqual(nextDeps, prevDeps)) {
        // ä¾èµ–æ²¡æœ‰å˜åŒ–ï¼Œè¿”å›ç¼“å­˜çš„å€¼
        return prevState[0];
      }
    }
  }
  
  // é‡æ–°è®¡ç®—
  const nextValue = create();
  hook.memoizedState = [nextValue, nextDeps];
  return nextValue;
}
```

### 2. useCallback

**ç”¨é€”**ï¼šç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

```javascript
function ParentComponent({ items }) {
  const [filter, setFilter] = useState('');
  
  // ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
  const handleItemClick = useCallback((id) => {
    console.log('ç‚¹å‡»äº†é¡¹ç›®:', id);
    // å¤„ç†ç‚¹å‡»é€»è¾‘
  }, []); // ç©ºä¾èµ–ï¼Œå‡½æ•°æ°¸ä¸å˜åŒ–
  
  // ç¼“å­˜å¸¦ä¾èµ–çš„å‡½æ•°
  const handleFilter = useCallback((newFilter) => {
    setFilter(newFilter);
    analytics.track('filter_changed', { filter: newFilter });
  }, []); // setFilter æ˜¯ç¨³å®šçš„ï¼Œå¯ä»¥çœç•¥
  
  return (
    <div>
      <FilterInput onFilter={handleFilter} />
      {items.map(item => (
        <MemoizedItem 
          key={item.id} 
          item={item} 
          onClick={handleItemClick} 
        />
      ))}
    </div>
  );
}

// å­ç»„ä»¶ä½¿ç”¨ memo ä¼˜åŒ–
const MemoizedItem = memo(function Item({ item, onClick }) {
  console.log('Item é‡æ–°æ¸²æŸ“:', item.id);
  
  return (
    <div onClick={() => onClick(item.id)}>
      {item.name}
    </div>
  );
});
```

**æºç å®ç°**ï¼š

```javascript
function useCallback(callback, deps) {
  const hook = updateWorkInProgressHook();
  const nextDeps = deps === undefined ? null : deps;
  const prevState = hook.memoizedState;
  
  if (prevState !== null) {
    if (nextDeps !== null) {
      const prevDeps = prevState[1];
      if (areHookInputsEqual(nextDeps, prevDeps)) {
        // ä¾èµ–æ²¡æœ‰å˜åŒ–ï¼Œè¿”å›ç¼“å­˜çš„å‡½æ•°
        return prevState[0];
      }
    }
  }
  
  // ç¼“å­˜æ–°å‡½æ•°
  hook.memoizedState = [callback, nextDeps];
  return callback;
}
```

## ä¸Šä¸‹æ–‡ Hook

### useContext

**ç”¨é€”**ï¼šè®¢é˜… React ä¸Šä¸‹æ–‡

```javascript
// åˆ›å»ºä¸Šä¸‹æ–‡
const ThemeContext = React.createContext();
const UserContext = React.createContext();

// ä¸Šä¸‹æ–‡æä¾›è€…
function App() {
  const [theme, setTheme] = useState('light');
  const [user, setUser] = useState(null);
  
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      <UserContext.Provider value={{ user, setUser }}>
        <MainContent />
      </UserContext.Provider>
    </ThemeContext.Provider>
  );
}

// æ¶ˆè´¹ä¸Šä¸‹æ–‡
function MainContent() {
  const { theme, setTheme } = useContext(ThemeContext);
  const { user } = useContext(UserContext);
  
  return (
    <div className={`app-${theme}`}>
      <h1>Welcome, {user?.name || 'Guest'}</h1>
      <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
        åˆ‡æ¢ä¸»é¢˜
      </button>
    </div>
  );
}
```

**æºç å®ç°**ï¼š

```javascript
function useContext(context) {
  const dispatcher = resolveDispatcher();
  return dispatcher.useContext(context);
}

// åœ¨ reconciler ä¸­çš„å®ç°
function readContext(context, observedBits) {
  const contextItem = {
    context: context,
    observedBits: observedBits,
    next: null,
  };
  
  if (lastContextDependency === null) {
    lastContextDependency = contextItem;
    currentlyRenderingFiber.dependencies = {
      lanes: NoLanes,
      firstContext: contextItem,
      responders: null,
    };
  } else {
    lastContextDependency = lastContextDependency.next = contextItem;
  }
  
  return context._currentValue;
}
```

## å¹¶å‘ç‰¹æ€§ Hook

### 1. useTransition

**ç”¨é€”**ï¼šå°†çŠ¶æ€æ›´æ–°æ ‡è®°ä¸ºè¿‡æ¸¡ï¼Œé¿å…é˜»å¡ç´§æ€¥æ›´æ–°

```javascript
function SearchPage() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();
  
  const handleSearch = (value) => {
    // ç´§æ€¥æ›´æ–°ï¼šç«‹å³æ›´æ–°è¾“å…¥æ¡†
    setQuery(value);
    
    // è¿‡æ¸¡æ›´æ–°ï¼šå¯ä»¥è¢«ä¸­æ–­
    startTransition(() => {
      setResults(performExpensiveSearch(value));
    });
  };
  
  return (
    <div>
      <input 
        value={query} 
        onChange={(e) => handleSearch(e.target.value)}
        placeholder="æœç´¢..." 
      />
      {isPending && <div>æœç´¢ä¸­...</div>}
      <SearchResults results={results} />
    </div>
  );
}
```

### 2. useDeferredValue

**ç”¨é€”**ï¼šå»¶è¿Ÿå€¼çš„æ›´æ–°ï¼Œä¼˜åŒ–æ€§èƒ½

```javascript
function App() {
  const [query, setQuery] = useState('');
  // å»¶è¿Ÿå€¼ï¼Œåœ¨ç´§æ€¥æ›´æ–°æ—¶ä¿æŒæ—§å€¼
  const deferredQuery = useDeferredValue(query);
  
  return (
    <div>
      <input 
        value={query} 
        onChange={(e) => setQuery(e.target.value)} 
      />
      {/* ä½¿ç”¨å»¶è¿Ÿå€¼è¿›è¡Œæœç´¢ï¼Œé¿å…é˜»å¡è¾“å…¥ */}
      <SearchResults query={deferredQuery} />
    </div>
  );
}

function SearchResults({ query }) {
  const results = useMemo(() => {
    // æ˜‚è´µçš„æœç´¢æ“ä½œ
    return performSearch(query);
  }, [query]);
  
  return <div>{results.map(/* ... */)}</div>;
}
```

### 3. useSyncExternalStore

**ç”¨é€”**ï¼šåŒæ­¥å¤–éƒ¨å­˜å‚¨çŠ¶æ€

```javascript
// å¤–éƒ¨å­˜å‚¨
class Store {
  constructor() {
    this.state = { count: 0 };
    this.listeners = [];
  }
  
  getSnapshot = () => {
    return this.state;
  };
  
  subscribe = (listener) => {
    this.listeners.push(listener);
    return () => {
      const index = this.listeners.indexOf(listener);
      if (index > -1) {
        this.listeners.splice(index, 1);
      }
    };
  };
  
  increment = () => {
    this.state = { count: this.state.count + 1 };
    this.listeners.forEach(listener => listener());
  };
}

const store = new Store();

function Counter() {
  const state = useSyncExternalStore(
    store.subscribe,
    store.getSnapshot,
    store.getSnapshot // æœåŠ¡ç«¯å¿«ç…§
  );
  
  return (
    <div>
      <p>Count: {state.count}</p>
      <button onClick={store.increment}>å¢åŠ </button>
    </div>
  );
}
```

## å·¥å…·ç±» Hook

### 1. useRef

**ç”¨é€”**ï¼šåˆ›å»ºå¯å˜çš„å¼•ç”¨å¯¹è±¡

```javascript
function TextInput() {
  const inputRef = useRef(null);
  const countRef = useRef(0);
  
  useEffect(() => {
    // èšç„¦è¾“å…¥æ¡†
    inputRef.current.focus();
  }, []);
  
  const handleClick = () => {
    // è®¿é—® DOM å…ƒç´ 
    console.log('è¾“å…¥å€¼:', inputRef.current.value);
    
    // ä¿å­˜ä¸è§¦å‘é‡æ¸²æŸ“çš„å€¼
    countRef.current += 1;
    console.log('ç‚¹å‡»æ¬¡æ•°:', countRef.current);
  };
  
  return (
    <div>
      <input ref={inputRef} type="text" />
      <button onClick={handleClick}>è·å–å€¼</button>
    </div>
  );
}
```

### 2. useImperativeHandle

**ç”¨é€”**ï¼šè‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼

```javascript
const FancyInput = forwardRef((props, ref) => {
  const inputRef = useRef();
  
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    },
    getValue: () => {
      return inputRef.current.value;
    },
    clear: () => {
      inputRef.current.value = '';
    }
  }));
  
  return <input ref={inputRef} {...props} />;
});

function Parent() {
  const fancyInputRef = useRef();
  
  return (
    <div>
      <FancyInput ref={fancyInputRef} />
      <button onClick={() => fancyInputRef.current.focus()}>
        èšç„¦
      </button>
      <button onClick={() => console.log(fancyInputRef.current.getValue())}>
        è·å–å€¼
      </button>
    </div>
  );
}
```

### 3. useId

**ç”¨é€”**ï¼šç”Ÿæˆå”¯ä¸€çš„ ID

```javascript
function FormField({ label, type = "text" }) {
  const id = useId();
  
  return (
    <div>
      <label htmlFor={id}>{label}</label>
      <input id={id} type={type} />
    </div>
  );
}

function LoginForm() {
  return (
    <form>
      <FormField label="ç”¨æˆ·å" />
      <FormField label="å¯†ç " type="password" />
    </form>
  );
}
```

### 4. useDebugValue

**ç”¨é€”**ï¼šåœ¨ React DevTools ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ Hook çš„æ ‡ç­¾

```javascript
function useOnlineStatus() {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  
  // åœ¨ DevTools ä¸­æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
  useDebugValue(isOnline ? 'Online' : 'Offline');
  
  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);
  
  return isOnline;
}

function StatusIndicator() {
  const isOnline = useOnlineStatus();
  
  return (
    <div style={{ color: isOnline ? 'green' : 'red' }}>
      {isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿'}
    </div>
  );
}
```

## Hook è°ƒç”¨é¡ºåºçš„é‡è¦æ€§

### ä¸ºä»€ä¹ˆå¿…é¡»ä¿æŒè°ƒç”¨é¡ºåº

React é€šè¿‡è°ƒç”¨é¡ºåºæ¥åŒ¹é… Hook ä¸å…¶çŠ¶æ€ï¼š

```javascript
// âœ… æ­£ç¡®ï¼šç¨³å®šçš„è°ƒç”¨é¡ºåº
function MyComponent({ condition }) {
  const [count, setCount] = useState(0);        // Hook 1
  const [name, setName] = useState('');         // Hook 2
  
  useEffect(() => {                             // Hook 3
    document.title = `${name}: ${count}`;
  }, [name, count]);
  
  if (condition) {
    const [extra, setExtra] = useState(false);  // âŒ æ¡ä»¶æ€§è°ƒç”¨
  }
  
  return <div>{count} - {name}</div>;
}

// âœ… æ­£ç¡®çš„å†™æ³•
function MyComponent({ condition }) {
  const [count, setCount] = useState(0);        // Hook 1
  const [name, setName] = useState('');         // Hook 2
  const [extra, setExtra] = useState(false);    // Hook 3
  
  useEffect(() => {                             // Hook 4
    document.title = `${name}: ${count}`;
  }, [name, count]);
  
  return (
    <div>
      {count} - {name}
      {condition && extra && <span>Extra</span>}
    </div>
  );
}
```

### Hook é“¾è¡¨ç»“æ„

```javascript
// React å†…éƒ¨çš„ Hook é“¾è¡¨
const hookList = {
  hook1: { memoizedState: 0, next: hook2 },      // useState(0)
  hook2: { memoizedState: '', next: hook3 },     // useState('')
  hook3: { memoizedState: false, next: hook4 },  // useState(false)
  hook4: { memoizedState: null, next: null },    // useEffect
};
```

## Hook æ€§èƒ½æœ€ä½³å®è·µ

### å®é™…æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

```javascript
// æ€§èƒ½ä¼˜åŒ–å‰ vs ä¼˜åŒ–åçš„å¯¹æ¯”
function ProductList({ products, category, searchTerm }) {
  // âŒ æ€§èƒ½é—®é¢˜ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è¿‡æ»¤å’Œæ’åº
  const filteredProducts = products
    .filter(p => p.category === category)
    .filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()))
    .sort((a, b) => a.price - b.price);
  
  return (
    <div>
      {filteredProducts.map(product => (
        <ProductCard 
          key={product.id} 
          product={product}
          onClick={() => console.log('ç‚¹å‡»äº†', product.name)} // âŒ æ¯æ¬¡éƒ½åˆ›å»ºæ–°å‡½æ•°
        />
      ))}
    </div>
  );
}

// âœ… ä¼˜åŒ–åçš„ç‰ˆæœ¬
function OptimizedProductList({ products, category, searchTerm }) {
  // âœ… ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
  const filteredProducts = useMemo(() => {
    console.log('ğŸ”„ é‡æ–°è®¡ç®—äº§å“åˆ—è¡¨'); // åªåœ¨ä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ
    return products
      .filter(p => p.category === category)
      .filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()))
      .sort((a, b) => a.price - b.price);
  }, [products, category, searchTerm]);
  
  // âœ… ä½¿ç”¨ useCallback ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
  const handleProductClick = useCallback((productName) => {
    console.log('ç‚¹å‡»äº†', productName);
    // å¯ä»¥æ·»åŠ æ›´å¤æ‚çš„é€»è¾‘ï¼Œå¦‚åˆ†æç»Ÿè®¡ç­‰
  }, []);
  
  return (
    <div>
      {filteredProducts.map(product => (
        <MemoizedProductCard 
          key={product.id} 
          product={product}
          onClick={handleProductClick}
        />
      ))}
    </div>
  );
}

// âœ… ä½¿ç”¨ memo ä¼˜åŒ–å­ç»„ä»¶
const MemoizedProductCard = memo(function ProductCard({ product, onClick }) {
  console.log('æ¸²æŸ“ ProductCard:', product.name);
  
  return (
    <div onClick={() => onClick(product.name)}>
      <h3>{product.name}</h3>
      <p>${product.price}</p>
    </div>
  );
});
```

### Hook é€‰æ‹©æŒ‡å—

| åœºæ™¯ | æ¨è Hook | åŸå›  |
|------|----------|------|
| ç®€å•çŠ¶æ€ | `useState` | è¯­æ³•ç®€æ´ï¼Œé€‚åˆç‹¬ç«‹çŠ¶æ€ |
| å¤æ‚çŠ¶æ€é€»è¾‘ | `useReducer` | çŠ¶æ€è½¬æ¢é€»è¾‘é›†ä¸­ï¼Œä¾¿äºæµ‹è¯• |
| æ˜‚è´µè®¡ç®— | `useMemo` | é¿å…é‡å¤è®¡ç®—ï¼Œæå‡æ€§èƒ½ |
| å‡½æ•°ç¼“å­˜ | `useCallback` | é˜²æ­¢å­ç»„ä»¶ä¸å¿…è¦é‡æ¸²æŸ“ |
| DOM æ“ä½œ | `useRef` | ç›´æ¥è®¿é—® DOM å…ƒç´  |
| è·¨ç»„ä»¶çŠ¶æ€ | `useContext` | é¿å… prop drilling |
| æ•°æ®è·å– | `useEffect` | å¤„ç†å‰¯ä½œç”¨å’Œæ¸…ç† |
| æœç´¢/è¿‡æ»¤ | `useDeferredValue` | é˜²æ­¢è¾“å…¥å¡é¡¿ |
| éç´§æ€¥æ›´æ–° | `useTransition` | ä¿æŒç•Œé¢å“åº”æ€§ |

## è°ƒè¯•å’Œé”™è¯¯å¤„ç†

### Hook è°ƒè¯•æŠ€å·§

```javascript
// Hook è°ƒè¯•å’Œé”™è¯¯å¤„ç†æœ€ä½³å®è·µ
function DebuggableComponent() {
  const [data, setData] = useState(null);
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(false);
  
  // ä½¿ç”¨ useDebugValue æä¾›è°ƒè¯•ä¿¡æ¯
  useDebugValue(data ? `æ•°æ®å·²åŠ è½½: ${data.length} é¡¹` : 'æ— æ•°æ®');
  
  // é”™è¯¯è¾¹ç•Œå¤„ç†
  const fetchData = useCallback(async () => {
    try {
      setLoading(true);
      setError(null);
      
      const response = await fetch('/api/data');
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const result = await response.json();
      setData(result);
    } catch (err) {
      console.error('æ•°æ®è·å–å¤±è´¥:', err);
      setError(err.message);
    } finally {
      setLoading(false);
    }
  }, []);
  
  // å¼€å‘ç¯å¢ƒä¸‹çš„é¢å¤–è°ƒè¯•ä¿¡æ¯
  useEffect(() => {
    if (process.env.NODE_ENV === 'development') {
      console.log('DebuggableComponent çŠ¶æ€:', { data, error, loading });
    }
  }, [data, error, loading]);
  
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error}</div>;
  if (!data) return <button onClick={fetchData}>åŠ è½½æ•°æ®</button>;
  
  return <div>æ•°æ®: {JSON.stringify(data)}</div>;
}
```

## æ€»ç»“ï¼šReact Hook çš„è®¾è®¡æ™ºæ…§

React 19 çš„ Hook ç³»ç»Ÿä½“ç°äº†æ·±åº¦çš„è®¾è®¡æ€è€ƒï¼š

### 1. æ ¸å¿ƒè®¾è®¡åŸåˆ™

- **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šé€šè¿‡ç»„åˆåŸºç¡€ Hook æ„å»ºå¤æ‚åŠŸèƒ½
- **æ˜¾å¼ä¼˜äºéšå¼**ï¼šä¾èµ–å…³ç³»æ˜ç¡®ï¼Œå‰¯ä½œç”¨å¯æ§
- **æ€§èƒ½ä¸å¼€å‘ä½“éªŒå¹³è¡¡**ï¼šæä¾›ä¼˜åŒ–å·¥å…·ï¼Œä½†éœ€è¦å¼€å‘è€…ç†è§£

### 2. Hook åˆ†ç±»æ€»è§ˆ

| ç±»åˆ« | Hook | æ ¸å¿ƒä»·å€¼ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|----------|
| **çŠ¶æ€ç®¡ç†** | useState, useReducer | å¯é¢„æµ‹çš„çŠ¶æ€æ›´æ–° | æœ¬åœ°çŠ¶æ€ã€å¤æ‚çŠ¶æ€é€»è¾‘ |
| **å‰¯ä½œç”¨** | useEffect, useLayoutEffect | å£°æ˜å¼å‰¯ä½œç”¨ç®¡ç† | æ•°æ®è·å–ã€è®¢é˜…ã€DOM æ“ä½œ |
| **æ€§èƒ½ä¼˜åŒ–** | useMemo, useCallback | ç²¾ç»†åŒ–æ€§èƒ½æ§åˆ¶ | æ˜‚è´µè®¡ç®—ã€å‡½æ•°ç¼“å­˜ |
| **ä¸Šä¸‹æ–‡** | useContext | è·¨ç»„ä»¶çŠ¶æ€å…±äº« | ä¸»é¢˜ã€ç”¨æˆ·ä¿¡æ¯ã€å¤šè¯­è¨€ |
| **å¹¶å‘ç‰¹æ€§** | useTransition, useDeferredValue | éé˜»å¡ç”¨æˆ·ç•Œé¢ | æœç´¢ã€å®æ—¶æ›´æ–° |
| **å·¥å…·ç±»** | useRef, useId | åº•å±‚èƒ½åŠ›è®¿é—® | DOM æ“ä½œã€å”¯ä¸€æ ‡è¯† |

### 3. ä¸å…¶ä»–æ–¹æ¡ˆçš„ä¼˜åŠ¿

| å¯¹æ¯”é¡¹ | React Hook | Vue 3 Composition | Angular Signals |
|--------|------------|-------------------|-----------------|
| **å­¦ä¹ æˆæœ¬** | ä¸­ç­‰ | è¾ƒä½ | è¾ƒé«˜ |
| **æ€§èƒ½æ§åˆ¶** | ç²¾ç»†åŒ– | è‡ªåŠ¨åŒ– | è‡ªåŠ¨åŒ– |
| **ç”Ÿæ€æˆç†Ÿåº¦** | æœ€é«˜ | å¿«é€Ÿå¢é•¿ | æ–°å…´ |
| **è°ƒè¯•ä½“éªŒ** | éœ€è¦ç†è§£æœºåˆ¶ | ç›´è§‚ | è¾ƒå¥½ |
| **TypeScript** | ä¼˜ç§€ | ä¼˜ç§€ | ä¼˜ç§€ |

### 4. æœ€ä½³å®è·µæ€»ç»“

1. **åˆç†é€‰æ‹© Hook**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„ Hook
2. **ç†è§£ä¾èµ–å…³ç³»**ï¼šæ­£ç¡®è®¾ç½® useEffect å’Œ useMemo çš„ä¾èµ–æ•°ç»„
3. **é¿å…è¿‡åº¦ä¼˜åŒ–**ï¼šä¸è¦ç›²ç›®ä½¿ç”¨ useCallback å’Œ useMemo
4. **ä¿æŒå‡½æ•°çº¯å‡€**ï¼šHook å‡½æ•°åº”è¯¥æ˜¯çº¯å‡½æ•°
5. **å–„ç”¨è‡ªå®šä¹‰ Hook**ï¼šå°†å¤æ‚é€»è¾‘æŠ½è±¡ä¸ºå¯å¤ç”¨çš„è‡ªå®šä¹‰ Hook

### 5. æœªæ¥å‘å±•è¶‹åŠ¿

React Hook çš„è®¾è®¡ä¸ºæœªæ¥å‘å±•å¥ å®šäº†åŸºç¡€ï¼š

- **ç¼–è¯‘å™¨ä¼˜åŒ–**ï¼šReact Compiler å°†è‡ªåŠ¨ä¼˜åŒ– Hook æ€§èƒ½
- **å¹¶å‘ç‰¹æ€§å¢å¼º**ï¼šæ›´å¤šå¹¶å‘æ¨¡å¼ä¸‹çš„ Hook
- **å¼€å‘å·¥å…·æ”¹è¿›**ï¼šæ›´å¥½çš„è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·
- **ç”Ÿæ€ç³»ç»Ÿå®Œå–„**ï¼šæ›´å¤šé«˜è´¨é‡çš„è‡ªå®šä¹‰ Hook åº“

React Hook ä¸ä»…è§£å†³äº†è¿‡å»çš„é—®é¢˜ï¼Œæ›´ä¸ºç°ä»£å‰ç«¯å¼€å‘æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ã€‚ç†è§£ Hook çš„åˆ†ç±»ã€ç‰¹ç‚¹å’Œæœ€ä½³å®è·µï¼Œæ˜¯æŒæ¡ç°ä»£ React å¼€å‘çš„å…³é”®ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Hook ä¸å‡½æ•°ç»„ä»¶çš„å…³ç³»ï¼Œä»¥åŠ Hook åœ¨ Fiber æ¶æ„ä¸­çš„å®ç°ç»†èŠ‚ã€‚